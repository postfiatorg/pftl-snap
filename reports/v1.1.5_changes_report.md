# pftl-snap changes since v1.1.5 (tag 8a4a653)

Scope:
- Compared tag v1.1.5 to origin/main.
- 21 commits after the release.
- Diff footprint: 3470 files changed, 76023 insertions, 659 deletions (dominated by vendored packages).

## Executive summary
- Migrated snap RPC networking from HTTP fetch to WebSocket client with lifecycle controls and wss endpoints.
- Rebranded from prior naming to Post Fiat across config, locale, and UI references.
- Hardened supply chain by vendoring @peersyst packages and fixing a ReDoS regex in NumericInput.
- Improved sign message UX by decoding hex messages safely and showing decoded and raw forms.
- Significant tooling and CI updates (Prettier v3, lint fixes, snaps-jest upgrade, corepack/yarn updates).

## Detailed changes by area

### Core snap RPC and networking
- RpcClient moved from fetch() to xrpl.js WebSocket client; added connect(), disconnect(), and changeNode() lifecycles.
- Node URLs migrated from https:// to wss:// endpoints.
- Network scope restricted to PFTL mainnet/testnet only.
- Files: `packages/snap/src/core/rpc-client/RpcClient.ts`, `packages/snap/src/core/StateManager.ts`, `packages/snap/src/core/Provider.ts`, `packages/site/src/common/config/config.base.json`.

### Sign message UX and hex decoding
- Sign message dialog now decodes hex messages when valid and safe (control characters filtered).
- Shows decoded text plus original hex to reduce ambiguity.
- Tests and translations updated to cover new labels.
- Files: `packages/snap/src/dialog/transaction/SignMessageDialog.ts`, `packages/snap/src/dialog/locale/en.ts`, `packages/snap/test/dialog/transaction/SignMessageDialog.spec.ts`.

### Branding and product config
- Rebrand across locale strings, configs, and UI copy from legacy naming to Post Fiat.
- Token/network types updated and pftlTestnet added to config types.
- Files: `packages/site/src/ui/locale/locales/en/common.json`, `packages/site/src/common/config/config.types.ts`, `packages/site/src/common/models/token.types.ts`.

### Security and permissions
- Supply chain hardening: vendored @peersyst packages from npm (not published) into repo.
- Included ReDoS fix in NumericInput regex.
- Snap permissions and manifest updated; removed external transaction review link.
- Files: `packages/vendor/@peersyst/*`, `packages/snap/snap.manifest.json`.

### Build, tooling, and CI
- Prettier v3 upgrade and eslint plugin updates; vendor directory excluded from linting.
- Yarn/corepack changes for Yarn 3 compatibility; yarn lock regenerated in several steps.
- Added vm polyfill fallback for site build.
- Snaps-jest upgraded; test fixes and CI workspace name corrected.
- Files: `.yarnrc.yml`, `.eslintignore`, `package.json`, `packages/site/craco.config.js`, `.github/workflows/build-lint-test.yml`, `packages/snap/package.json`, `yarn.lock`.

### Manifest and release artifacts
- Removed invalid platformVersion from snap manifest.
- Manifest and SHA sums updated post-build/rebase; SHA sum updated then reverted and re-updated.
- Files: `packages/snap/snap.manifest.json`.

## Commit ledger (oldest to newest)
- 894e67a chore: remove CODEOWNERS
- e8bd7eb chore: vendor @peersyst packages (supply chain fix)
- 0899d2d fix: add pftlTestnet to config types
- a972650 Upgrade to prettier v3 and exclude vendor from linting
- bbc8b34 Fix e2e test workspace name from xrpl-snap to @postfiat/pftl-snap
- 5fa7b93 Fix lint errors and formatting issues
- 031f493 Remove invalid platformVersion from snap manifest
- 371ff3d Update yarn.lock after vendor package formatting
- f4e3714 Update snap manifest after build
- b9411e7 Upgrade snaps-jest and fix pre-existing test bugs
- 7565edd Merge pull request #3 from postfiatorg/vendor-peersyst-packages
- 777c030 feat: HTTP to WebSocket migration, rebrand to Post Fiat, security hardening
- cb4b66c Update manifest and yarn.lock after rebase
- 4119706 Fix lint errors and add vm polyfill fallback
- 9250648 Merge pull request #4 from postfiatorg/implementation-changes
- 9641115 feat: Show Plain Text in Sign Message Dialog
- 396c504 fix: Solve Linter Issues
- 0938634 fix: Remove Explicit Path & Use Lint Fix
- 67cb490 fix: Revert Snap SHA Sum
- 8a97be7 fix: Update SHA Sum
- dcd3f47 Merge pull request #5 from postfiatorg/feature/hex-messages

## Notable risk/impact notes
- Repo size and build time increased substantially due to vendored packages.
- WebSocket migration changes connection lifecycle and error handling; regression testing needed on network connectivity and reconnection logic.
- Sign message dialog now interprets hex; ensure no false decoding on non-hex payloads.
